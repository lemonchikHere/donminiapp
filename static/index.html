<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don Estate - Telegram Mini App</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        #preloader {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #preloader img {
            max-width: 200px;
            margin-bottom: 20px;
        }
        #preloader p {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 16px;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="preloader">
        <img src="/static/assets/logo.jpg" alt="Don Estate">
        <p>Загрузка...</p>
    </div>
    <div id="root"></div>
    <script>
        // Mock Telegram WebApp for browser testing
        if (!window.Telegram || !window.Telegram.WebApp) {
            console.log("Creating mock Telegram.WebApp object for browser testing.");
            window.Telegram = {
                WebApp: {
                    initDataUnsafe: {
                        user: {
                            id: 999,
                            first_name: 'Browser',
                            last_name: 'User',
                            username: 'browser_user',
                            language_code: 'en',
                        },
                        chat_instance: 'test_chat_instance',
                        chat_type: 'private',
                        auth_date: Math.floor(new Date().getTime() / 1000),
                        hash: 'test_hash_string_from_telegram',
                    },
                    initData: '',
                    MainButton: {
                        isVisible: false,
                        show() { this.isVisible = true; console.log('Mock MainButton.show()'); },
                        hide() { this.isVisible = false; console.log('Mock MainButton.hide()'); },
                        setText(text) { console.log(`Mock MainButton.setText: ${text}`); },
                        onClick(callback) { console.log('Mock MainButton.onClick registered.'); window.mockMainButtonCallback = callback; },
                        offClick(callback) { console.log('Mock MainButton.offClick registered.'); },
                        enable() { console.log('Mock MainButton.enable()'); },
                        disable() { console.log('Mock MainButton.disable()'); },
                    },
                    BackButton: {
                        isVisible: false,
                        show() { this.isVisible = true; console.log('Mock BackButton.show()'); },
                        hide() { this.isVisible = false; console.log('Mock BackButton.hide()'); },
                        onClick(callback) { console.log('Mock BackButton.onClick registered.'); window.mockBackButtonCallback = callback; },
                        offClick(callback) { console.log('Mock BackButton.offClick registered.'); }
                    },
                    expand: () => console.log('Mock WebApp.expand()'),
                    ready: () => {
                        if (window.TelegramWebAppReady) {
                            window.TelegramWebAppReady();
                        }
                    },
                    onEvent: (eventType, eventHandler) => console.log(`Mock WebApp.onEvent(${eventType}) registered`),
                    sendData: (data) => console.log('Mock WebApp.sendData:', data),
                    close: () => console.log('Mock WebApp.close()'),
                    themeParams: {
                      bg_color: '#ffffff',
                      text_color: '#000000',
                      hint_color: '#707579',
                      link_color: '#007aff',
                      button_color: '#007aff',
                      button_text_color: '#ffffff',
                    },
                    colorScheme: 'light',
                    isClosingConfirmationEnabled: false,
                    enableClosingConfirmation: () => { this.isClosingConfirmationEnabled = true; console.log('Mock enableClosingConfirmation()'); },
                    disableClosingConfirmation: () => { this.isClosingConfirmationEnabled = false; console.log('Mock disableClosingConfirmation()'); },
                    showAlert: (message) => alert(`Mock showAlert: ${message}`),
                    showConfirm: (message, callback) => {
                        const result = confirm(`Mock showConfirm: ${message}`);
                        if (callback) callback(result);
                    }
                }
            };
            // A simple way to trigger the button's onClick from the browser console for testing
            window.Telegram.WebApp.initData = new URLSearchParams(window.Telegram.WebApp.initDataUnsafe).toString();
        }
    </script>
    <script type="text/babel" src="/static/app.js"></script>
    <script>
        // Force hide preloader after 3 seconds to unblock UI for debugging,
        // as the window.load event seems to be blocked by an error in app.js.
        setTimeout(function() {
            var preloader = document.getElementById('preloader');
            if (preloader) {
                console.log('Forcibly hiding preloader.');
                preloader.style.display = 'none';
            }
        }, 3000);
    </script>
</body>
</html>
